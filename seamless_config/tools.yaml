hashserver:
  ADDED: [hostname, network_interface, conda, port_start, port_end, tunnel]
  INJECTED: [CLUSTER, BUFFERDIR, PROJECTSUBDIR, STAGEDIR, MODE]
  timeout: 600
  workdir_template: "$BUFFERDIR$PROJECTSUBDIR$STAGEDIR"
  key_template: 'hashserver-$CLUSTER-$MODE-{"$PROJECTSUBDIR$STAGEDIR".strip("/").replace("/", "--")}'
  command_template: "hashserver --encoding sha-256 --port-range {port_start} {port_end} --status-file {status_file} --host {config['network_interface']} --timeout {timeout} {workdir}{' --writable' if '$MODE' == 'rw' else ''}"
  handshake: healthcheck

database:
  ADDED: [hostname, network_interface, conda, port_start, port_end, tunnel]
  INJECTED: [CLUSTER, DATABASE_DIR, PROJECTSUBDIR, STAGEDIR, MODE]
  timeout: 600
  workdir_template: "$DATABASE_DIR$PROJECTSUBDIR$STAGEDIR"
  key_template: 'database-$CLUSTER-$MODE-{"$PROJECTSUBDIR$STAGEDIR".strip("/").replace("/", "--")}'
  command_template: "seamless-database --port-range {port_start} {port_end} --status-file {status_file} --host {config['network_interface']} --timeout {timeout}{' --writable' if '$MODE' == 'rw' else ''} {workdir}/seamless.db"
  handshake: healthcheck

jobserver:
  ADDED:
    [
      workers,
      hostname,
      network_interface,
      conda,
      port_start,
      port_end,
      tunnel,
      file_parameters,
    ]
  INJECTED: [CLUSTER, PROJECTSUBDIR, STAGESUBDIR]
  timeout: 600
  workdir_template: "/tmp"
  key_template: 'jobserver-$CLUSTER-$MODE-{"$PROJECTSUBDIR$STAGESUBDIR".strip("/").replace("/", "--")}'
  command_template: "seamless-jobserver --workers {workers} --port-range {port_start} {port_end} --status-file {status_file} --host {config['network_interface']} --timeout {timeout}"
  handshake: healthcheck

daskserver:
  ADDED:
    [
      cluster_string,
      hostname,
      network_interface,
      conda,
      port_start,
      port_end,
      tunnel,
      file_parameters,
    ]
  INJECTED: [CLUSTER, PROJECTSUBDIR, STAGESUBDIR]
  timeout: 600
  workdir_template: "/tmp"
  key_template: 'daskserver-$CLUSTER-$MODE-{"$PROJECTSUBDIR$STAGESUBDIR".strip("/").replace("/", "--")}'
  command_template: "seamless-dask-wrapper {cluster_string} --port-range {port_start} {port_end} --status-file {status_file} --host {config['network_interface']} --timeout {timeout}"
  handshake:
    path: health
    port_name: dashboard_port

pure_daskserver:
  ADDED:
    [
      cluster_string,
      hostname,
      network_interface,
      conda,
      port_start,
      port_end,
      tunnel,
      file_parameters,
    ]
  INJECTED: [CLUSTER, QUEUE]
  timeout: 600
  workdir_template: "/tmp"
  key_template: "pure-daskserver-$CLUSTER-$QUEUE"
  command_template: "seamless-dask-wrapper {cluster_string} --port-range {port_start} {port_end} --status-file {status_file} --host {config['network_interface']} --timeout {timeout}"
  handshake:
    path: health
    port_name: dashboard_port
